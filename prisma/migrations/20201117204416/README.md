# Migration `20201117204416`

This migration has been generated by Alejandro D at 11/17/2020, 4:44:16 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Session" DROP CONSTRAINT "Session_userId_fkey"

ALTER TABLE "public"."Event" DROP CONSTRAINT "Event_categoryId_fkey"

ALTER TABLE "public"."Event" DROP CONSTRAINT "Event_locationId_fkey"

ALTER TABLE "public"."Event" DROP CONSTRAINT "Event_pkey",
DROP COLUMN "locationId",
DROP COLUMN "categoryId",
ADD COLUMN "instructorId" integer   NOT NULL ,
DROP COLUMN "id",
ADD COLUMN "id" SERIAL,
ADD PRIMARY KEY ("id")

ALTER TABLE "public"."Location" ADD COLUMN "eventId" integer   NOT NULL 

ALTER TABLE "public"."User" ADD COLUMN "photoUrl" text   

CREATE TABLE "public"."FollowersOfEvents" (
"followerId" integer   NOT NULL ,
"eventId" integer   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("followerId","eventId")
)

CREATE TABLE "public"."_CategoryToEvent" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

DROP TABLE "public"."Session"

CREATE UNIQUE INDEX "_CategoryToEvent_AB_unique" ON "public"."_CategoryToEvent"("A", "B")

CREATE INDEX "_CategoryToEvent_B_index" ON "public"."_CategoryToEvent"("B")

CREATE UNIQUE INDEX "Location_eventId_unique" ON "public"."Location"("eventId")

ALTER TABLE "public"."FollowersOfEvents" ADD FOREIGN KEY("followerId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."FollowersOfEvents" ADD FOREIGN KEY("eventId")REFERENCES "public"."Event"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_CategoryToEvent" ADD FOREIGN KEY("A")REFERENCES "public"."Category"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_CategoryToEvent" ADD FOREIGN KEY("B")REFERENCES "public"."Event"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Event" ADD FOREIGN KEY("instructorId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Location" ADD FOREIGN KEY("eventId")REFERENCES "public"."Event"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201116211248..20201117204416
--- datamodel.dml
+++ datamodel.dml
@@ -3,63 +3,63 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model User {
-  id             Int       @id @default(autoincrement())
-  createdAt      DateTime  @default(now())
-  updatedAt      DateTime  @updatedAt
-  name           String?   @unique
-  email          String    @unique
-  hashedPassword String
-  role           String    @default("user")
-  sessions       Session[]
-  Events         Event[]
+  id                Int                 @id @default(autoincrement())
+  createdAt         DateTime            @default(now())
+  updatedAt         DateTime            @updatedAt
+  name              String?             @unique
+  email             String              @unique
+  photoUrl          String?
+  hashedPassword    String
+  role              String              @default("user")
+  FollowingEvents   Event[]
+  InstructedEvents  Event[]             @relation("instructorTable")
+  FollowersOfEvents FollowersOfEvents[]
 }
-model Session {
-  id                 Int       @id @default(autoincrement())
-  createdAt          DateTime  @default(now())
-  updatedAt          DateTime  @updatedAt
-  expiresAt          DateTime?
-  handle             String    @unique
-  user               User?     @relation(fields: [userId], references: [id])
-  userId             Int?
-  hashedSessionToken String?
-  antiCSRFToken      String?
-  publicData         String?
-  privateData        String?
-}
-
 model Category {
-  id     Int     @id @default(autoincrement())
-  name   String
-  events Event[]
+  id    Int     @id @default(autoincrement())
+  name  String
+  posts Event[]
 }
 /// These will be the online/offline events
 model Event {
-  id          String    @id @default(uuid())
-  createdAt   DateTime  @default(now())
-  updatedAt   DateTime  @updatedAt
-  title       String
-  datetime    DateTime
-  duration    Int // integer represents minutes
-  online      Boolean?  @default(true)
-  description String?
-  location    Location? @relation(fields: [locationId], references: [id])
-  locationId  Int?
-  User        User?     @relation(fields: [userId], references: [id])
-  userId      Int?
-  Category    Category? @relation(fields: [categoryId], references: [id])
-  categoryId  Int?
+  id                Int                 @id @default(autoincrement())
+  title             String
+  createdAt         DateTime            @default(now())
+  updatedAt         DateTime            @updatedAt
+  datetime          DateTime
+  duration          Int // integer represents minutes
+  online            Boolean?            @default(true)
+  description       String?
+  Instructor        User                @relation("instructorTable", fields: [instructorId], references: [id])
+  instructorId      Int
+  Categories        Category[]
+  Location          Location?
+  User              User?               @relation(fields: [userId], references: [id])
+  userId            Int?
+  FollowersOfEvents FollowersOfEvents[]
 }
+model FollowersOfEvents {
+  Follower   User     @relation(fields: [followerId], references: [id])
+  followerId Int
+  Event      Event    @relation(fields: [eventId], references: [id])
+  eventId    Int
+  createdAt  DateTime @default(now())
+
+  @@id([followerId, eventId])
+}
+
 model Location {
-  id     Int     @id @default(autoincrement())
-  lat    Float
-  lng    Float
-  events Event[]
+  id      Int   @id @default(autoincrement())
+  Event   Event @relation(fields: [eventId], references: [id])
+  eventId Int
+  lat     Float
+  lng     Float
 }
```


